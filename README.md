![ç”¨VUEå®ç°ä¸€ä¸ªä¹è°±æ’­æ”¾å™¨](https://upload-images.jianshu.io/upload_images/1511070-e86fba3c8ecd2b89.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

## å‰è¨€ï¼š
æ•´ç†ä¸€ä¸ªå¹´åˆåšçš„ä¸€ä¸ªAPPé¡¹ç›®ï¼Œé¡¹ç›®ä¸­çš„æ ¸å¿ƒåŠŸèƒ½æ˜¯ä¸ã€ä¸€èµ·ç»ƒç´ã€‘è¿™ä¸ª app è¾ƒä¸ºç›¸ä¼¼ï¼Œå…¶ä¸­æœ€é‡ç‚¹çš„æ˜¯ä¹è°±æ’­æ”¾å’Œæ ¹æ®ä¹è°±ç»ƒä¹ è¯„åˆ†çš„åŠŸèƒ½ã€‚ä»Šå¤©æˆ‘ä»¬ä¸»è¦ä»‹ç»ä¸‹æˆ‘ä»¬é€‰ç”¨çš„ä¸€ä¸ªä¹è°±æ’­æ”¾çš„æ–¹æ¡ˆã€‚

## é‡ç‚¹è°ƒç ”
ç»è¿‡å¤§é‡çš„è°ƒç ”åœ¨ä¹è°±å¯è§†åŒ–æ–¹å‘å·²ç»å‘å±•å¤šå¹´ï¼Œæœ‰ä¸å°‘æˆç†Ÿçš„å¼€æºè§£å†³æ–¹æ¡ˆï¼Œå±‚å±‚ç­›é€‰åæœ‰ä¸‰ä¸ªåº“æ¯”è¾ƒé€‚åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼ˆæ”¯æŒä¹è°±å®šåˆ¶ã€éŸ³æºå®šåˆ¶ã€musicxml æ ¼å¼æ”¯æŒï¼‰ï¼š

[alphaTab â€“ music notation for everyone](https://www.alphatab.net/) è¿™ä¸ªæ˜¯åŸºäº typescript çš„å®ç°ï¼Œä¸»æ”»å‰ä»–è°±ï¼Œå½“ç„¶å…¶ä»–ä¹è°±ä¹Ÿæ”¯æŒã€‚
**ç‰¹ç‚¹ï¼šå¯ä»¥è¯†åˆ«ä¹è°±å’Œå®šåˆ¶éŸ³æºæ’­æ”¾ï¼Œå¯ä»¥è¯»å– musicxmlæ ¼å¼**
![image.png](https://upload-images.jianshu.io/upload_images/1511070-a993196858d9e380.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/600)


[VexFlow - HTML5 Music Engraving](http://www.vexflow.com/) ä¸€ä¸ªç”¨äºæ¸²æŸ“éŸ³ä¹ç¬¦å·çš„JavaScriptåº“ï¼ŒéŸ³æºæ’­æ”¾éœ€è¦å®šåˆ¶å¼€å‘ã€‚
![image.png](https://upload-images.jianshu.io/upload_images/1511070-7b97624fea5d93ba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/600)


[opensheetmusicdisplay](https://opensheetmusicdisplay.github.io/demo/) ä¸€ä¸ªå¼€æºçš„ä¹è°±æ’­æ”¾å™¨ã€‚
**ç‰¹ç‚¹ï¼šç®€å•ï¼Œæ”¯æŒ musicxml ä¹è°±æ–‡ä»¶ï¼Œæ”¯æŒéŸ³æºï¼Œæ”¯æŒ svgã€canvas ä¸¤ç§æ¸²æŸ“æ¨¡å¼**
![image.png](https://upload-images.jianshu.io/upload_images/1511070-d36c2d513b8246e2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/600)



## é€‰å‹
åŸºäºä»¥ä¸Šä¸‰ä¸ªå¼€æºåº“è¿›è¡Œå®šåˆ¶å¼€å‘ï¼Œå‘ç°ä¼šæœ‰ä¸åŒçš„é—®é¢˜ï¼š
**AlphaTap**
ç¼ºç‚¹ï¼šmusicxmlæ”¯æŒä¸å®Œå–„ï¼Œæ ·å¼å®šåˆ¶è¾ƒä¸ºå›°éš¾ï¼ŒéŸ³æºå®šåˆ¶ä¸çµæ´»
ä¼˜ç‚¹ï¼šç¾è§‚ã€å±å¹•è‡ªé€‚åº”å®Œå–„ã€å®šåˆ¶å¼€å‘å®¹æ˜“

**VexFlow**
ç¼ºç‚¹ï¼šè¿™ä¸ªåº”è¯¥ä¹Ÿä¸ç®—æ˜¯ç¼ºç‚¹ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªä¹è°±ç»˜åˆ¶åº“ï¼Œæ‰€ä»¥å¯¹äºmusicxmlã€éŸ³æºç­‰æ”¯æŒï¼Œéœ€è¦ç”¨ç¬¬ä¸‰æ–¹åŸºäºå®ƒå®ç°çš„åº“ï¼Œæˆ–è€…æˆ‘ä»¬è‡ªå·±å¼€å‘ï¼Œä½†æ˜¯å½“æ—¶çš„é¡¹ç›®å‘¨æœŸå¤ªç´§å¼ ï¼Œæœ€å¥½è¿˜æ˜¯æ”¾å¼ƒæ‰äº†ã€‚
ä¼˜ç‚¹ï¼šå¼ºå¤§ã€ä¸åŸç”Ÿ app ç»“åˆå¥½ã€æœ‰åŸºäº flutter çš„æ–¹æ¡ˆ

**OpenSheetMusicDisplay**
ç¼ºç‚¹ï¼šç®€é™‹ï¼Œéœ€è¦ä¼˜åŒ–çš„åœ°æ–¹è¾ƒå¤šï¼ŒéŸ³æºéœ€è¦å®šåˆ¶
ä¼˜ç‚¹ï¼šè¿™ä¸ªæ˜¯å®Œæ•´çš„ä¹è°±æ’­æ”¾å™¨å®ç°ï¼ŒåŸºç¡€çš„ä¹è°±æ’­æ”¾åŠŸèƒ½ã€éŸ³æºåŠ è½½ã€ä¹è°±æ ¼å¼ musicxml æ”¯æŒéƒ½æ¯”è¾ƒå®Œæ•´ã€‚

**æœ€ç»ˆæˆ‘ä»¬é€‰æ‹©æ OSMD è¿™ä¸ªæ–¹æ¡ˆï¼Œä¸‹é¢è®²ä¸€ä¸‹æˆ‘ä»¬æ˜¯å¦‚ä½•ä½¿ç”¨çš„**

## å¼€å‘
ä¸ºäº†å…¼å®¹ç§»åŠ¨å±•ç¤ºï¼Œå’Œæœ€ç»ˆåµŒå…¥åˆ°åŸç”Ÿ app ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†å‡ ä¸ªåº“ï¼š
```
$ yarn add vue opensheetmusicdisplay vant vue-webview-js-bridge 

vant ui # é€‚é…ç§»åŠ¨ç«¯ç»„ä»¶çš„ UI
vue-webview-js-bridge # ä¸åŸç”Ÿ app é€šä¿¡
```
**é¡¹ç›®ç»“æ„å¦‚ä¸‹**
```
 .
â”œâ”€â”€ LICENSE
â”œâ”€â”€ README.md
â”œâ”€â”€ babel.config.js
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ postcss.config.js
â”œâ”€â”€ public
â”‚Â Â  â”œâ”€â”€ Happy_Birthday.musicxml
â”‚Â Â  â”œâ”€â”€ static
â”‚Â Â  â””â”€â”€ voice.svg
â”œâ”€â”€ src
â”‚Â Â  â”œâ”€â”€ App.vue
â”‚Â Â  â”œâ”€â”€ assets
â”‚Â Â  â”œâ”€â”€ components
â”‚Â Â  â”œâ”€â”€ layout
â”‚Â Â  â”œâ”€â”€ main.js
â”‚Â Â  â”œâ”€â”€ plugins
â”‚Â Â  â”œâ”€â”€ router
â”‚Â Â  â”œâ”€â”€ scores.js
â”‚Â Â  â””â”€â”€ views
â”œâ”€â”€ vue.config.js
â”œâ”€â”€ yarn-error.log
â””â”€â”€ yarn.lock

```
å¯ä»¥çœ‹å‡ºéå¸¸ç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªåŸºç¡€çš„ vue å·¥ç¨‹ï¼Œä¸»è¦æ˜¯ view ä¸­çš„ score.vueï¼Œå®ƒæ•´åˆäº† OSMD æ’­æ”¾å™¨ï¼Œå’ŒåŠ è½½ä¹è°±çš„æ–¹å¼ã€‚çœ‹ä¸‹é‡ç‚¹ä»£ç ï¼š
**views/score.vue**
```
<template>
  <div>
    <van-nav-bar
            right-text="é…ç½®"
            @click-left="onClickLeft"
            @click-right="onClickRight"
            fixed
            :border="false"
            style="background: transparent"
    >
      <template #right>
    <!-- èŠ‚æ‹å™¨ -->
        <metronome-view :intf="intf" />
        <metronome
                ref="metronome"
                :gain="gain"
                :tempo="tempo"
                :beat="beat"
                :mute="mute"
                :pause="pause"
                @start="onMetronomeStart"
                @stop="onMetronomeStop"
        />
      </template>
    </van-nav-bar>

    <div class="music-score">
      <Score
              v-if="mounted"
              @osmdInit="osmdInit"
              @scoreLoaded="scoreLoaded"
              :score="selectedScore"
              :ready="pbEngineReady"
      />
...
</template>

<script>
  import { Tabbar, TabbarItem } from 'vant';
  import { Button } from 'vant';
  import {MetronomeView, Metronome} from '../components/metronome'
  import PlayButton from "../components/PlayButton";
  import PlaybackSidebar from "../components/PlaybackSidebar";
  import Score from "../components/Score";
  import scores from "../scores";

  import PlaybackEngine from "../../../../dist/PlaybackEngine";
  import { EventBus } from '../plugins/event-bus.js';

  const PlaybackState = {
    INIT: "INIT",
    PLAYING: "PLAYING",
    STOPPED: "STOPPED",
    PAUSED: "PAUSED",
    FINISHED: "FINISHED"
  }

  export default {
    name: "app",
    components: {
      PlayButton,
      Metronome,
      MetronomeView,
      osmd: null,
      Score,
      VanButton: Button,
      VanTabbar: Tabbar,
      VanTabbarItem: TabbarItem,
    },
    data() {
      return {
        sheetScore: '',
        active: 0,
        pbEngine: new PlaybackEngine(),
        pbEngineReady: false,
        scores: scores,
        selectedScore: null,
        osmd: null,
        scoreTitle: "",
        drawer: true,
        mounted: false,
        onMusicMode: true,
        onMetronome: false,
        onGameMode: false,

        metronomeShow: false,
        beat: 4,
        gain: -30,
        tempo: 120,
        mute: false,
        pause: false,
        playing: false,
        intf: null
      };
    },
 
    methods: {
      initBridge() { 
        ...
      },
      osmdInit(osmd) {
        this.osmd = osmd;
        this.selectedScore = this.sheetScore
      },
      async scoreLoaded() {
        // console.log("Score loaded");
        if (this.osmd.sheet.title) this.scoreTitle = this.osmd.sheet.title.text;
        await this.pbEngine.loadScore(this.osmd);
        this.pbEngineReady = true;
        // åŠ è½½å®Œæˆ
        await this.callNativeFinishPlay()
      },
      scoreChanged(scoreUrl) {
        if (this.pbEngine.state === "PLAYING") this.pbEngine.stop();
        this.selectedScore = scoreUrl;
        this.pbEngineReady = false;
      },
    },
    computed: {
      isGamePlaying() {
        return this.onGameMode && this.playing
      },
      isMusicPlaying() {
        return !this.onGameMode && this.playing
      }
    },
    mounted() {
      const query = this.$route.query
      if (query.score) {
        this.sheetScore = query.score
      }
      // åœæ­¢æ—¶è°ƒç”¨åŸç”Ÿè§¦å‘
      EventBus.$on(PlaybackState.STOPPED, () => {
        // this.callNativeFinishPlay()
        this.callNativeEndPlay()
      })
      this.initBridge()
      setTimeout(() => {
        // This extra delay before rendering the score component seems to help occasional issues where the
        // OSMD cursor img element gets detached from the DOM and doesn't show unless
        // you refresh the page. A less pretty workaround until root cause is determined
        this.mounted = true;
      }, 200)
    }
  };
</script>

```
**components/Score.vue**

```
<script>
import axios from "axios";
import { OpenSheetMusicDisplay } from "opensheetmusicdisplay";

export default {
  props: ["score", "ready"],
  data() {
    return {
      osmd: null,
      scoreLoading: false
    };
  },
  watch: {
    score(val, oldVal) {
      if (!val || val === oldVal) return;
      this.loadScore(val);
    },
    ready(val, oldVal) {
      if (!val || val === oldVal) return
      this.$toast.clear()
    }
  },
  async mounted() {
    this.osmd = new OpenSheetMusicDisplay(this.$refs.scorediv, {
      followCursor: true,
      autoResize: false,
    });
    this.$emit("osmdInit", this.osmd);
    if (this.score) this.loadScore(this.score);
    this.osmd.rules.DefaultColorCursor = '#008be8'
  },
  methods: {
    async loadScore(scoreUrl) {
      this.scoreLoading = true;
      // this.osmd.rules.DefaultColorCursor = '#008be8'

      let scoreXml = await axios.get(scoreUrl);
      await this.osmd.load(scoreXml.data);

      this.osmd.rules.DefaultColorCursor = '#008be8'

      this.scoreLoading = false;
      await this.$nextTick();
      await this.osmd.render();
      if (this.scoreLoading || !this.ready) {

        // this.$toast.loading({
        //   message: 'åŠ è½½ä¸­...',
        //   forbidClick: true,
        //   loadingType: 'spinner',
        // });
      }
      this.$emit("scoreLoaded");
    }
  }
};
</script>
```

**ä»¥ä¸Šä¸¤ä¸ªæ–‡ä»¶çš„ä¸»è¦ä½œç”¨æ˜¯ï¼Œ**
- score component ç”¨æ¥å¼•å…¥å’Œæ•´åˆ osmd æ¨¡å—ï¼ŒåŒ…å«åŠ è½½ä¹è°±ã€åŠ è½½éŸ³é¢‘ã€ä¹è°±æ¸²æŸ“
- score view ä½œä¸ºå…¥å£é¡µé¢ç”¨æ¥è®¿é—®ä¹è°±ï¼Œæ¡¥æ¥ä¸åŸç”Ÿ app é€šä¿¡æ§åˆ¶
  **æœ€ç»ˆæ•ˆæœï¼š**
  ![image.png](https://upload-images.jianshu.io/upload_images/1511070-1e17025d7a6dcf6f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

**åšä¸ªæ ·æœºå±•ç¤ºä¸‹ï¼š**
![Hello.png](https://upload-images.jianshu.io/upload_images/1511070-0b3f2e3faad6bf00.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

## æ€»ç»“
æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†ä¹è°±çš„å¯è§†åŒ–æ–¹æ¡ˆï¼Œå¹¶å°†æ–¹æ¡ˆåº”ç”¨åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¹¶åšå‡ºç¤ºä¾‹ã€‚å¯ä»¥ç»™æœ‰ç›¸å…³éœ€æ±‚çš„æœ‹å‹åšä¸ºå‚è€ƒã€‚

## ç›¸å…³èµ„æº
https://github.com/baisheng/osmd-player **æ–‡ç« ä¸­çš„ç³»ç»Ÿæºç **

[alphaTab â€“ music notation for everyone](https://www.alphatab.net/)
[VexFlow - HTML5 Music Engraving](http://www.vexflow.com/)
[opensheetmusicdisplay](https://opensheetmusicdisplay.github.io/demo/)


# ğŸµ æˆ‘ä»¬çš„åˆå¥ OSMD Audio player

## Build

```
yarn build
```

## Apps

### The Score
æˆ‘ä»¬çš„åˆå¥ h5 ç«¯

**Live demo:** https://test.picker.cc/ <br/>

```
yarn install
yarn serve
yarn build
```

### åŸç”Ÿè°ƒç”¨
åŸç”Ÿè°ƒH5ï¼Œéƒ½ä¸éœ€è¦å‚æ•°
1ï¼Œå¼€å§‹æ’­æ”¾  startPlay
2ï¼Œæš‚åœæ’­æ”¾  pausePlay
3ï¼Œç»“æŸæ’­æ”¾  endPlay
H5è°ƒåŸç”Ÿ
1ï¼Œåˆ‡æ¢æ¨¡å¼  changeModel  éœ€è¦å‚æ•°â€œmodelâ€  1æ˜¯æ¬£èµæ¨¡å¼ï¼›2æ˜¯è¯„åˆ†æ¨¡å¼
2ï¼Œåœæ­¢æ’­æ”¾  endPlay  ä¸éœ€è¦å‚æ•°

### æ”¹å…‰æ ‡é¢œè‰²é—®é¢˜
ç­‰ 0.9.3

### ISSUE
**Hide measures that includes invisible notes.**
https://github.com/opensheetmusicdisplay/opensheetmusicdisplay/issues/913

### ä¸€äº›èµ„æº
https://github.com/opensheetmusicdisplay/opensheetmusicdisplay/issues/393
**å…³äº cursor æ¢é¢œè‰²çš„é—®é¢˜ï¼Œè¦ç­‰0.9.3 ç‰ˆæœ¬**
https://github.com/opensheetmusicdisplay/opensheetmusicdisplay/discussions/961
**osmd-options**
https://github.com/opensheetmusicdisplay/opensheetmusicdisplay/wiki/Getting-Started#osmd-options
https://github.com/opensheetmusicdisplay/opensheetmusicdisplay/blob/1c49122b4bf2c38380e7c291451e02ccdffa0b2c/src/OpenSheetMusicDisplay/OSMDOptions.ts

# ğŸµ æˆ‘ä»¬çš„åˆå¥ OSMD Audio player

## Build

```
yarn build
```

## Apps

### The Score
æˆ‘ä»¬çš„åˆå¥ h5 ç«¯

**Live demo:** https://test.picker.cc/ <br/>

```
yarn install
yarn serve
yarn build
```

### åŸç”Ÿè°ƒç”¨
åŸç”Ÿè°ƒH5ï¼Œéƒ½ä¸éœ€è¦å‚æ•°
1ï¼Œå¼€å§‹æ’­æ”¾  startPlay
2ï¼Œæš‚åœæ’­æ”¾  pausePlay
3ï¼Œç»“æŸæ’­æ”¾  endPlay
H5è°ƒåŸç”Ÿ
1ï¼Œåˆ‡æ¢æ¨¡å¼  changeModel  éœ€è¦å‚æ•°â€œmodelâ€  1æ˜¯æ¬£èµæ¨¡å¼ï¼›2æ˜¯è¯„åˆ†æ¨¡å¼
2ï¼Œåœæ­¢æ’­æ”¾  endPlay  ä¸éœ€è¦å‚æ•°

### æ”¹å…‰æ ‡é¢œè‰²é—®é¢˜
ç­‰ 0.9.3

### ISSUE
**Hide measures that includes invisible notes.**
https://github.com/opensheetmusicdisplay/opensheetmusicdisplay/issues/913

### ä¸€äº›èµ„æº
https://github.com/opensheetmusicdisplay/opensheetmusicdisplay/issues/393
**å…³äº cursor æ¢é¢œè‰²çš„é—®é¢˜ï¼Œè¦ç­‰0.9.3 ç‰ˆæœ¬**
https://github.com/opensheetmusicdisplay/opensheetmusicdisplay/discussions/961
**osmd-options**
https://github.com/opensheetmusicdisplay/opensheetmusicdisplay/wiki/Getting-Started#osmd-options
https://github.com/opensheetmusicdisplay/opensheetmusicdisplay/blob/1c49122b4bf2c38380e7c291451e02ccdffa0b2c/src/OpenSheetMusicDisplay/OSMDOptions.ts
